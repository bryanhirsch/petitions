<?php

/**
 * @file
 * This is the main module file for Petitions Signatures Display.
 */

/**
 * Implements hook_menu().
 */
function petitions_signatures_display_menu() {
  $items = array();

  $items['admin/config/petitions/signatures'] = array(
    'title' => 'Signatures Display',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('petitions_signatures_display_configure'),
    'access arguments' => array('administer site configuration'),
    'file' => 'petitions_signatures_display.admin.inc',
    'description' => "Configure signatures display.",
  );

  return $items;
}

/**
 * Returns [first name] [last initial].
 */
function petitions_signatures_display_fname_linitial($first_name = '', $last_name = '') {
  if ($first_name) {
    $name = ucfirst($first_name);
  }

  if ($last_name) {
    if ($name) {
      $name .= ' ' . ucfirst(mb_substr(trim($last_name), 0, 1)) . '.';
    }
    else {
      $name = ucfirst(mb_substr(trim($last_name), 0, 1)) . '.';
    }
  }

  return $name;
}

/**
 * Returns [first initial] [last initial].
 */
function petitions_signatures_display_finitial_linitial($first_name = '', $last_name = '') {
  if ($first_name) {
    $name = ucfirst(mb_substr(trim($first_name), 0, 1)) . '.';
  }

  if ($last_name) {
    if ($name) {
      $name .= ' ' . ucfirst(mb_substr(trim($last_name), 0, 1)) . '.';
    }
    else {
      $name = ucfirst(mb_substr(trim($last_name), 0, 1)) . '.';
    }
  }

  return $name;
}

/**
 * Returns formatted name.
 */
function petitions_signatures_display_style($username, $first_name = '', $last_name = '') {
  $function = variable_get('petitions_signatures_display_initials', 'petitions_signatures_display_fname_linitial');

  if ($first_name || $last_name) {
    $name = $function($first_name, $last_name);
  }
  else {
    $name = $username;
  }

  return $name;
}

/**
 * Returns an array including city, state, and abbreviated country.
 * Invokes _perform_lookup() in wh_zipcodelookup.module.
 */
function petitions_signatures_display_location($zipcode = '') {
  if (module_exists('wh_zipcodelookup') && function_exists('_perform_lookup')) {
    $location = _perform_lookup($zipcode);
    return $location;
  }
  else {
    return;
  }
}

/**
 * Returns city and state formatted for display.
 * Invokes _perform_lookup() in wh_zipcodelookup.module.
 */
function petitions_signatures_display_location_formatted($zipcode = '') {
  if (module_exists('wh_zipcodelookup') && function_exists('_perform_lookup')) {
    $location = petitions_signatures_display_location($zipcode);
    $city = $location[0][city];
    $state = $location[0][state];
    if ($city && $state) {
      $formatted_location = $city . ', ' . $state;
    }
    elseif ($city && !$state) {
      $formatted_location = $city;
    }
    elseif (!$city && $state) {
      $formatted_location = $state;
    }
    return $formatted_location;
  } else {
    return;
  }
}
